<?xml version="1.0"?>

<!-- Boeing 747-400 GE CF6-80C2B1F Engine/FADEC -->
<!-- Copyright (c) 2024-2025 Josh Davidson (Octal450) and Gijs de Rooy -->

<system name="propulsion-system">

    <property value="32.2">/systems/fadec/limit/rated-temp</property>
    <property value="57160">/systems/fadec/limit/rated-thrust</property>

    <channel name="Thrust Limits">

        <fcs_function name="/systems/fadec/limit/rated-thrust-n1">
            <function>
                <table> <!-- N1 at which rated thrust is provided, same as take-off ref voor low altitudes -->
                    <independentVar lookup="row">/position/altitude-ft</independentVar>
                    <independentVar lookup="column">propulsion/tat-c</independentVar>
                    <tableData>
                              -50     0    15    25    35    45    54
                        -2000  89.6  99.0 101.6 103.4 105.1 104.2 102.8
                            0  91.9 101.6 104.3 106.0 106.9 105.6 103.1
                         1000  92.9 102.6 105.3 107.1 107.2 105.8 103.4
                         2000  93.7 103.5 106.2 108.0 107.3 105.8 103.6
                         3000  94.5 104.2 107.0 108.8 107.2 105.2 103.6
                         5000  95.9 105.8 108.5 108.9 107.2 104.4 103.0
                        10000  98.9 109.0 110.3 108.2 104.9 104.4 103.8
                        45000 101.4 101.8 107.5 110.0 113.2 118.9 118.9
                    </tableData> <!-- 45000 ft is guesstimate -->
                </table>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/milthrust-no-density"> <!-- Copy of MilThrust table without density effects -->
            <function>
                <table>
                    <independentVar lookup="row">velocities/mach</independentVar>
                    <independentVar lookup="column">/position/altitude-ft</independentVar>
                    <tableData>
                              -10000  0       10000   20000   30000   43000   50000
                        0.0   1.2600  1.0000  0.7400  0.5640  0.3920  0.2710  0.0000
                        0.2   1.1710  0.9740  0.6970  0.5360  0.3850  0.2610  0.0000
                        0.4   1.1500  0.9570  0.6920  0.5460  0.3870  0.2530  0.0000
                        0.6   1.1810  0.9410  0.7210  0.5660  0.3580  0.2180  0.0000
                        0.8   1.2290  1.0200  0.7820  0.5570  0.3040  0.1930  0.0000
                        0.9   1.2580  1.0200  0.7820  0.5220  0.2710  0.1140  0.0000
                        1.0   1.1810  0.9510  0.7210  0.4410  0.1740  0.0450  0.0000
                        1.2   0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
                        1.4   0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/milthrust-density"> <!-- Copy of MilThrust table with density effects -->
            <function>
                <table>
                    <independentVar lookup="row">velocities/mach</independentVar>
                    <independentVar lookup="column">atmosphere/density-altitude</independentVar>
                    <tableData>
                              -10000  0       10000   20000   30000   43000   50000
                        0.0   1.2600  1.0000  0.7400  0.5640  0.3920  0.2710  0.0000
                        0.2   1.1710  0.9740  0.6970  0.5360  0.3850  0.2610  0.0000
                        0.4   1.1500  0.9570  0.6920  0.5460  0.3870  0.2530  0.0000
                        0.6   1.1810  0.9410  0.7210  0.5660  0.3580  0.2180  0.0000
                        0.8   1.2290  1.0200  0.7820  0.5570  0.3040  0.1930  0.0000
                        0.9   1.2580  1.0200  0.7820  0.5220  0.2710  0.1140  0.0000
                        1.0   1.1810  0.9510  0.7210  0.4410  0.1740  0.0450  0.0000
                        1.2   0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
                        1.4   0.0000  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <!-- Following functions fix a FGTurbine inaccuracy... rated thrust N1% should be rated thrust lbs -->
        <!-- These calculations change it so that the rated power at sea level is at the correct N1% value. It still changes with altitude and mach as it should -->
        <fcs_function name="/systems/fadec/limit/rated-thrust-target"> <!-- Thrust it should produce at the rated N1 -->
            <function>
                <sum>
                    <product>
                        <property>propulsion/engine[0]/IdleThrust</property> <!-- It doesn't matter which engine, same for all -->
                        <property>/systems/fadec/limit/rated-thrust</property>
                    </product>
                    <product>
                        <difference>
                            <property>/systems/fadec/limit/rated-thrust</property>
                            <product>
                                <property>propulsion/engine[0]/IdleThrust</property> <!-- It doesn't matter which engine, same for all -->
                                <property>/systems/fadec/limit/rated-thrust</property>
                            </product>
                        </difference>
                        <property>/systems/fadec/limit/milthrust-no-density</property>
                    </product>
                </sum>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/rated-thrust-actual"> <!-- Actual thrust that FGTurbine would produce at the rated N1 -->
            <function>
                <sum>
                    <product>
                        <property>propulsion/engine[0]/IdleThrust</property> <!-- It doesn't matter which engine, same for all -->
                        <property>/systems/fadec/limit/rated-thrust</property>
                    </product>
                    <product>
                        <product>
                            <difference>
                                <property>/systems/fadec/limit/rated-thrust</property>
                                <product>
                                    <property>propulsion/engine[0]/IdleThrust</property> <!-- It doesn't matter which engine, same for all -->
                                    <property>/systems/fadec/limit/rated-thrust</property>
                                </product>
                            </difference>
                            <property>/systems/fadec/limit/milthrust-density</property>
                        </product>
                        <pow>
                            <quotient>
                                <difference>
                                    <property>/systems/fadec/limit/rated-thrust-n1</property>
                                    <value>25.0</value> <!-- idle N1 -->
                                </difference>
                                <value>92.5</value> <!-- max N1 - idle N1 -->
                            </quotient>
                            <value>2</value>
                        </pow>
                    </product>
                </sum>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/rated-thrust-factor">
            <function>
                <ifthen>
                    <nq> <!-- Prevent divide by 0 -->
                        <property>/systems/fadec/limit/rated-thrust-actual</property>
                        <value>0</value>
                    </nq>
                    <quotient>
                        <property>/systems/fadec/limit/rated-thrust-target</property>
                        <property>/systems/fadec/limit/rated-thrust-actual</property>
                    </quotient>
                    <value>1</value>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/go-around-table">
            <function>
                <sum>
                    <table>
                        <independentVar lookup="row">/position/altitude-ft</independentVar>
                        <independentVar lookup="column">propulsion/tat-c</independentVar>
                        <tableData>
                                  -50   -40   -30   -20   -10     0     5    10    15    20    25    30    35    40    45    50    57
                            -2000  89.2  91.1  93.0  94.9  96.7  98.5  99.4 100.3 101.2 102.0 102.9 103.7 104.6 105.2 104.6 104.0 102.9
                            -1000  90.3  92.3  94.2  96.1  98.0  99.8 100.7 101.6 102.5 103.4 104.2 105.1 105.9 105.9 105.3 104.7 103.0
                                0  91.5  93.5  95.4  97.3  99.2 101.1 102.0 102.9 103.8 104.7 105.5 106.4 107.3 106.6 106.0 105.3 103.2
                             1000  92.4  94.4  96.4  98.3 100.2 102.1 103.0 103.9 104.8 105.7 106.6 107.4 107.7 106.9 106.2 105.5 103.4
                             2000  93.3  95.3  97.3  99.2 101.1 103.0 103.9 104.8 105.7 106.6 107.5 108.4 107.8 107.0 106.2 105.1 103.6
                             3000  94.0  96.0  98.0 100.0 101.9 103.7 104.6 105.5 106.5 107.4 108.3 108.5 107.7 106.9 106.1 104.5 103.6
                             4000  94.7  96.7  98.7 100.6 102.5 104.4 105.3 106.2 107.2 108.1 109.0 108.4 107.5 106.7 105.6 104.0 103.6
                             5000  95.5  97.5  99.5 101.5 103.4 105.2 106.2 107.1 108.0 109.0 109.3 108.6 107.8 106.9 105.4 104.3 103.9
                             6000  96.2  98.3 100.3 102.2 104.2 106.0 107.0 107.9 108.8 109.8 109.4 108.7 107.8 106.9 105.0 104.5 104.0
                             7000  96.9  98.9 100.9 102.9 104.8 106.7 107.7 108.6 109.6 110.2 109.5 108.7 107.8 106.3 104.7 104.4 104.0
                             8000  97.5  99.5 101.6 103.6 105.5 107.4 108.4 109.3 110.3 110.3 109.6 108.6 107.6 105.6 104.7 104.4 103.9
                             9000  97.9 100.0 102.1 104.4 106.0 107.9 108.9 109.9 110.8 110.1 109.2 108.2 106.9 104.9 104.6 104.3 103.9
                            10000  98.4 100.5 102.5 104.6 106.5 108.5 109.4 110.4 110.9 109.8 108.8 107.8 106.1 104.8 104.6 104.3 103.8
                        </tableData>
                    </table>
                    <table>
                        <independentVar lookup="row">atmosphere/pressure-altitude</independentVar>
                        <independentVar lookup="column">/systems/fms/flight-data/to-packs</independentVar>
                        <tableData>
                                  0   1   2
                            -2000 0.5 0.3 0.0
                             2000 0.5 0.3 0.0
                             3000 0.6 0.4 0.0
                             4000 0.7 0.5 0.0
                             5000 0.8 0.5 0.0
                             6000 0.8 0.5 0.0
                             7000 0.8 0.5 0.0
                             8000 0.8 0.6 0.0
                             9000 0.8 0.6 0.0
                            10000 0.9 0.6 0.0
                        </tableData>
                    </table>
                </sum>
            </function>
        </fcs_function>
        
        <fcs_function name="/systems/fadec/limit/go-around">
            <function>
                <quotient>
                    <floor>
                        <sum>
                            <product>
                                <property>/systems/fadec/limit/go-around-table</property>
                                <value>10</value>
                            </product>
                            <value>0.5</value> <!-- Make it round correctly -->
                        </sum>
                    </floor>
                    <value>10</value>
                </quotient>
            </function>
        </fcs_function>
        
        <fcs_function name="/systems/fadec/limit/takeoff-table">
            <function>
                <sum>
                    <table>
                        <independentVar lookup="row">atmosphere/pressure-altitude</independentVar>
                        <independentVar lookup="column">propulsion/tat-c</independentVar>
                        <tableData>
                                  -50   -40   -30   -20   -10     0     5    10    15    20    25    30    35    40    45    50    54
                            -2000  89.6  91.6  93.5  95.4  97.2  99.0  99.9 100.8 101.6 102.5 103.4 104.2 105.1 104.8 104.2 103.6 102.8
                            -1000  90.8  92.8  94.7  96.6  98.5 100.3 101.2 102.1 103.0 103.9 104.7 105.6 106.2 105.5 104.9 104.3 103.1
                                0  91.9  93.9  95.9  97.8  99.7 101.6 102.5 103.4 104.3 105.2 106.0 106.9 106.9 106.2 105.6 104.7 103.1
                             1000  92.9  94.9  96.9  98.8 100.7 102.6 103.5 104.4 105.3 106.2 107.1 108.0 107.2 106.5 105.8 104.4 103.4
                             2000  93.7  95.8  97.8  99.7 101.6 103.5 104.4 105.3 106.2 107.1 108.0 108.1 107.3 106.5 105.8 103.9 103.6
                             3000  94.5  96.5  98.5 100.4 102.3 104.2 105.1 106.1 107.0 107.9 108.8 108.0 107.2 106.4 105.2 103.8 103.6
                             4000  95.1  97.2  99.2 101.1 103.0 104.9 105.8 106.8 107.7 108.6 108.8 107.9 107.0 106.2 104.6 103.9 103.6
                             5000  95.9  98.0 100.0 101.9 103.9 105.8 106.7 107.6 108.5 109.5 108.9 108.1 107.2 106.2 104.4 104.2 103.0
                             6000  96.7  98.7 100.8 102.7 104.7 106.5 107.5 108.4 109.4 109.6 109.0 108.2 107.3 105.8 104.6 104.3 104.0
                             7000  97.3  99.4 101.4 103.4 105.3 107.2 108.2 109.2 110.1 109.8 109.1 108.2 107.2 105.0 104.5 104.3 104.0
                             8000  97.9 100.0 102.1 104.1 106.0 107.9 108.9 109.9 110.5 109.9 109.0 108.0 106.5 104.8 104.5 104.2 103.9
                             9000  98.4 100.5 102.6 104.6 106.5 108.5 109.4 110.4 110.5 109.6 108.6 107.6 105.6 104.7 104.4 104.1 103.9
                            10000  98.9 101.0 103.0 105.1 107.0 109.0 110.0 110.9 110.3 109.2 108.2 107.0 104.9 104.7 104.4 104.1 103.8
                        </tableData>
                    </table>
                    <table>
                        <independentVar lookup="row">atmosphere/pressure-altitude</independentVar>
                        <independentVar lookup="column">/systems/fms/flight-data/to-packs</independentVar>
                        <tableData>
                                  0   1   2
                            -2000 0.5 0.3 0.0
                             2000 0.5 0.4 0.0
                             3000 0.6 0.4 0.0
                             4000 0.7 0.5 0.0
                             5000 0.8 0.5 0.0
                             6000 0.8 0.5 0.0
                             7000 0.8 0.5 0.0
                             8000 0.8 0.5 0.0
                             9000 0.8 0.6 0.0
                            10000 0.9 0.6 0.0
                        </tableData>
                    </table>
                </sum>
            </function>
        </fcs_function>
        
        <fcs_function name="/systems/fadec/limit/takeoff-no-flex">
            <function>
                <quotient>
                    <floor>
                        <sum>
                            <product>
                                <property>/systems/fadec/limit/takeoff-table</property>
                                <value>10</value>
                            </product>
                            <value>0.5</value> <!-- Make it round correctly -->
                        </sum>
                    </floor>
                    <value>10</value>
                </quotient>
            </function>
        </fcs_function>
        
        <summer name="/systems/fadec/limit/flex-temp-input"> <!-- (Rated - Flex) + TAT -->
            <input>/systems/fadec/limit/rated-temp</input>
            <input>-/systems/fms/flight-data/flex-temp</input>
            <input>propulsion/tat-c</input>
        </summer>
        
        <fcs_function name="/systems/fadec/limit/takeoff-flex-table">
            <function>
                <sum>
                    <table>
                        <independentVar lookup="row">atmosphere/pressure-altitude</independentVar>
                        <independentVar lookup="column">/systems/fadec/limit/flex-temp-input</independentVar>
                        <tableData>
                                  -50   -40   -30   -20   -10     0     5    10    15    20    25    30    35    40    45    50    54
                            -2000  89.6  91.6  93.5  95.4  97.2  99.0  99.9 100.8 101.6 102.5 103.4 104.2 105.1 104.8 104.2 103.6 102.8
                            -1000  90.8  92.8  94.7  96.6  98.5 100.3 101.2 102.1 103.0 103.9 104.7 105.6 106.2 105.5 104.9 104.3 103.1
                                0  91.9  93.9  95.9  97.8  99.7 101.6 102.5 103.4 104.3 105.2 106.0 106.9 106.9 106.2 105.6 104.7 103.1
                             1000  92.9  94.9  96.9  98.8 100.7 102.6 103.5 104.4 105.3 106.2 107.1 108.0 107.2 106.5 105.8 104.4 103.4
                             2000  93.7  95.8  97.8  99.7 101.6 103.5 104.4 105.3 106.2 107.1 108.0 108.1 107.3 106.5 105.8 103.9 103.6
                             3000  94.5  96.5  98.5 100.4 102.3 104.2 105.1 106.1 107.0 107.9 108.8 108.0 107.2 106.4 105.2 103.8 103.6
                             4000  95.1  97.2  99.2 101.1 103.0 104.9 105.8 106.8 107.7 108.6 108.8 107.9 107.0 106.2 104.6 103.9 103.6
                             5000  95.9  98.0 100.0 101.9 103.9 105.8 106.7 107.6 108.5 109.5 108.9 108.1 107.2 106.2 104.4 104.2 103.0
                             6000  96.7  98.7 100.8 102.7 104.7 106.5 107.5 108.4 109.4 109.6 109.0 108.2 107.3 105.8 104.6 104.3 104.0
                             7000  97.3  99.4 101.4 103.4 105.3 107.2 108.2 109.2 110.1 109.8 109.1 108.2 107.2 105.0 104.5 104.3 104.0
                             8000  97.9 100.0 102.1 104.1 106.0 107.9 108.9 109.9 110.5 109.9 109.0 108.0 106.5 104.8 104.5 104.2 103.9
                             9000  98.4 100.5 102.6 104.6 106.5 108.5 109.4 110.4 110.5 109.6 108.6 107.6 105.6 104.7 104.4 104.1 103.9
                            10000  98.9 101.0 103.0 105.1 107.0 109.0 110.0 110.9 110.3 109.2 108.2 107.0 104.9 104.7 104.4 104.1 103.8
                        </tableData>
                    </table>
                    <table>
                        <independentVar lookup="row">atmosphere/pressure-altitude</independentVar>
                        <independentVar lookup="column">/systems/fms/flight-data/to-packs</independentVar>
                        <tableData>
                                  0   1   2
                            -2000 0.5 0.3 0.0
                             2000 0.5 0.4 0.0
                             3000 0.6 0.4 0.0
                             4000 0.7 0.5 0.0
                             5000 0.8 0.5 0.0
                             6000 0.8 0.5 0.0
                             7000 0.8 0.5 0.0
                             8000 0.8 0.5 0.0
                             9000 0.8 0.6 0.0
                            10000 0.9 0.6 0.0
                        </tableData>
                    </table>
                </sum>
            </function>
        </fcs_function>
        
        <fcs_function name="/systems/fadec/limit/takeoff-flex">
            <function>
                <quotient>
                    <floor>
                        <sum>
                            <product>
                                <min> <!-- FLEX can not increase thrust past T/O -->
                                    <property>/systems/fadec/limit/takeoff-table</property>
                                    <property>/systems/fadec/limit/takeoff-flex-table</property>
                                </min>
                                <value>10</value>
                            </product>
                            <value>0.5</value> <!-- Make it round correctly -->
                        </sum>
                    </floor>
                    <value>10</value>
                </quotient>
            </function>
        </fcs_function>
        
        <switch name="/systems/fadec/limit/takeoff">
            <default value="/systems/fadec/limit/takeoff-no-flex"/>
            <test value="/systems/fadec/limit/takeoff-flex">
                /systems/fms/flight-data/flex-active eq 1
            </test>
        </switch>
        
        <fcs_function name="/systems/fadec/limit/mct-table">
            <function>
                <table>
                    <independentVar lookup="row">velocities/mach</independentVar>
                    <independentVar lookup="column">propulsion/tat-c</independentVar>
                    <independentVar lookup="table">atmosphere/pressure-altitude</independentVar>
                    <tableData breakPoint="5000">
                             -10    -5     0     5    10    15    20    25    30    35    40    45
                        0.30  97.3  98.2  99.1  99.9 100.8 101.6 102.3 102.1 101.5 100.9 100.3  99.7
                        0.36  96.9  97.7  98.6  99.5 100.3 101.2 101.9 102.4 101.8 101.2 100.6 100.1
                        0.42  96.4  97.2  98.1  99.0  99.8 100.7 101.4 102.2 102.2 101.6 101.0 100.4
                        0.48  95.8  96.7  97.5  98.4  99.2 100.1 100.9 101.6 102.3 102.3 102.1 101.5
                        0.55  95.2  96.0  96.9  97.7  98.6  99.4 100.2 101.0 101.8 102.5 102.0 101.4
                    </tableData>
                    <tableData breakPoint="16000">
                             -25   -20   -15   -10    -5     0     5    10    15    20    25    30
                        0.39 101.5 102.4 103.4 104.3 105.2 106.0 106.0 105.4 104.8 104.2 103.6 102.9
                        0.47 100.2 101.1 102.0 103.0 103.9 104.7 105.6 105.2 104.6 104.0 103.4 102.8
                        0.54  98.8  99.7 100.6 101.5 102.4 103.3 104.2 105.0 104.4 103.8 103.2 102.7
                        0.62  97.3  98.2  99.1 100.0 100.9 101.8 102.7 103.5 104.3 103.8 103.2 102.6
                        0.69  95.8  96.7  97.6  98.5  99.4 100.3 101.1 102.0 102.8 103.6 103.3 102.7
                    </tableData>
                    <tableData breakPoint="25000">
                             -35   -30   -25   -20   -15   -10    -5     0     5    10    15    20
                        0.48 103.6 104.7 105.8 106.8 107.9 108.9 108.1 107.2 106.3 105.4 104.7 102.6
                        0.57 103.2 104.2 105.2 106.2 107.1 108.0 107.8 106.8 105.9 105.1 104.2 103.5
                        0.66 100.6 101.6 102.6 103.6 104.5 105.4 106.3 106.4 105.4 104.5 103.6 102.8
                        0.75  98.8  99.8 100.7 101.7 102.7 103.6 104.5 105.3 105.9 104.9 104.1 103.2
                        0.84  97.3  98.3  99.2 100.2 101.1 102.1 103.0 103.9 104.7 105.5 105.0 104.1
                    </tableData>
                    <tableData breakPoint="31000">
                             -45   -40   -35   -30   -25   -20   -15   -10    -5     0     5    10
                        0.55 101.5 102.6 103.6 104.7 105.8 106.8 107.9 108.3 107.4 106.5 105.7 104.4
                        0.65 101.5 102.6 103.6 104.7 105.8 106.8 107.9 107.9 107.0 106.1 105.3 104.4
                        0.76 100.6 101.6 102.7 103.7 104.7 105.7 106.5 107.4 106.5 105.6 104.8 103.9
                        0.85  97.5  98.6  99.6 100.6 101.6 102.6 103.5 104.4 105.2 105.4 104.3 103.5
                    </tableData>
                    <tableData breakPoint="39000">
                             -50   -45   -40   -35   -30   -25   -20   -15   -10    -5     0     5
                        0.66 100.4 101.5 102.6 103.6 104.7 105.8 106.8 106.0 105.0 104.2 103.4 102.9
                        0.78 100.0 101.1 102.1 103.2 104.2 105.0 105.8 105.5 104.7 103.7 102.8 102.1
                        0.89  96.8  97.8  98.9  99.9 100.9 102.0 102.9 103.6 104.3 103.8 102.9 101.9
                    </tableData>
                </table>
                <!-- TODO: packs off, engine and wing anti-ice on -->
            </function>
        </fcs_function>
        
        <fcs_function name="/systems/fadec/limit/mct">
            <function>
                <quotient>
                    <floor>
                        <sum>
                            <product>
                                <property>/systems/fadec/limit/mct-table</property>
                                <value>10</value>
                            </product>
                            <value>0.5</value> <!-- Make it round correctly -->
                        </sum>
                    </floor>
                    <value>10</value>
                </quotient>
            </function>
        </fcs_function>
        
        <fcs_function name="/systems/fadec/limit/climb-table">
            <function>
                <ifthen>
                    <eq>
                        <property>/controls/gear/gear-down</property>
                        <value>0</value>
                    </eq>
                    <table> <!-- Gear up -->
                        <independentVar lookup="row">atmosphere/pressure-altitude</independentVar>
                        <independentVar lookup="column">propulsion/tat-c</independentVar>
                        <tableData>
                                  -40   -35   -30   -25   -20   -15   -10    -5     0     5    10    15    20    25    30    35    40    45    50
                                0  87.2  88.1  89.0  89.9  90.7  91.6  92.5  93.3  94.1  95.0  95.8  96.6  97.4  98.2  99.0  99.7 100.3  99.9  99.4
                             5000  90.3  91.2  92.1  93.0  93.9  94.8  95.7  96.6  97.4  98.3  99.1  99.9 100.8 101.6 102.3 102.5 101.9 101.3 100.8
                            10000  92.6  93.6  94.5  95.4  96.3  97.2  98.1  99.0  99.9 100.7 101.6 102.4 103.2 103.9 103.7 103.1 102.6 102.0 102.0
                            15000  93.6  94.5  95.5  96.4  97.3  98.2  99.1 100.0 100.9 101.8 102.7 103.5 104.1 103.4 102.8 102.1 101.6 101.1 101.1
                            20000  95.2  96.2  97.1  98.1  99.0  99.9 100.8 101.7 102.6 103.3 104.1 104.3 103.6 103.2 102.6 102.0 102.0 102.0 102.0
                            25000  97.4  98.4  99.4 100.4 101.3 102.3 103.2 104.2 105.0 105.8 105.9 104.9 104.1 103.2 103.2 103.2 103.2 103.2 103.2
                            30000  99.0 100.1 101.1 102.1 103.0 104.0 104.9 105.7 106.3 105.2 104.4 103.6 102.7 101.9 101.9 101.9 101.9 101.9 101.9
                            35000 100.8 101.8 102.9 103.9 104.7 105.5 105.6 104.6 103.7 102.7 101.9 101.1 101.1 101.1 101.1 101.1 101.1 101.1 101.1
                            40000 100.8 101.8 102.8 103.8 104.6 105.4 105.0 104.1 103.2 102.3 101.5 100.9 100.9 100.9 100.9 100.9 100.9 100.9 100.9
                            45000 100.4 101.5 102.5 103.5 104.3 105.1 104.5 103.7 102.8 101.9 101.1 101.1 101.1 101.1 101.1 101.1 101.1 101.1 101.1
                        </tableData>
                    </table>
                    <table> <!-- Gear down -->
                        <independentVar lookup="row">atmosphere/pressure-altitude</independentVar>
                        <independentVar lookup="column">propulsion/tat-c</independentVar>
                        <tableData>
                                  -20   -15   -10    -5     0     5    10    15    20    25    30    35    40    45    50    55
                                0  91.9  92.8  93.6  94.5  95.3  96.2  97.0  97.8  98.7  99.4 100.1 100.1  99.6  99.0  98.4  97.8
                             5000  95.2  96.1  97.0  97.9  98.8  99.7 100.5 101.3 102.1 102.6 102.0 101.4 100.8 100.3  99.7  99.7
                            10000  98.1  99.0  99.9 100.8 101.7 102.6 103.4 104.2 103.7 103.2 102.6 102.0 101.5 101.0 101.0 101.0
                            12000  99.0  99.9 100.8 101.7 102.6 103.4 104.2 104.3 103.7 103.1 102.5 101.9 101.3 101.3 101.3 101.3
                            14000  99.7 100.6 101.6 102.5 103.3 104.2 104.8 104.1 103.5 102.8 102.3 101.7 101.0 101.0 101.0 101.0
                            16000 101.4 102.4 103.3 104.2 105.0 105.9 105.6 105.0 104.3 103.7 103.2 102.4 102.4 102.4 102.4 102.4
                            18000 102.3 103.3 104.2 105.1 106.0 106.2 105.6 105.1 104.6 103.9 103.2 103.2 103.2 103.2 103.2 103.2
                            20000 103.4 104.3 105.2 106.0 106.7 105.9 105.4 104.9 104.3 103.6 103.0 103.0 103.0 103.0 103.0 103.0
                            22000 104.8 105.7 106.6 107.4 107.1 106.4 105.7 105.0 104.2 103.6 103.6 103.6 103.6 103.6 103.6 103.6
                            24000 106.0 107.0 107.8 108.2 107.2 106.4 105.6 104.8 104.0 103.4 103.4 103.4 103.4 103.4 103.4 103.4
                            26000 106.8 107.9 108.9 108.2 107.3 106.4 105.5 104.7 104.0 104.0 104.0 104.0 104.0 104.0 104.0 104.0
                            28000 106.8 107.9 108.9 108.2 107.3 106.4 105.6 104.8 104.8 104.8 104.8 104.8 104.8 104.8 104.8 104.8
                            30000 106.8 107.9 108.9 108.1 107.3 106.4 105.5 105.5 105.5 105.5 105.5 105.5 105.5 105.5 105.5 105.5
                        </tableData>
                    </table>
                <!-- TODO: Subtract for engine and wing anti-ice -->
                </ifthen>
            </function>
        </fcs_function>
        
        <fcs_function name="/systems/fadec/limit/climb">
            <function>
                <quotient>
                    <floor>
                        <sum>
                            <product>
                                <property>/systems/fadec/limit/climb-table</property>
                                <value>10</value>
                            </product>
                            <value>0.5</value> <!-- Make it round correctly -->
                        </sum>
                    </floor>
                    <value>10</value>
                </quotient>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/cruise-table">
            <function>
                <table>
                    <independentVar lookup="row">atmosphere/pressure-altitude</independentVar>
                    <independentVar lookup="column">propulsion/tat-c</independentVar>
                    <tableData>
                              -60   -50   -40   -30   -20   -10     0    10    20    30
                        22000  93.1  93.1  93.1  95.0  97.0  98.9 100.7 102.6 101.8 100.4
                        25000  94.7  94.7  94.7  96.7  98.6 100.6 102.5 103.1 101.5 100.2
                        30000  94.4  94.4  96.5  98.5 100.5 102.5 104.4 102.4 100.6 100.6
                        35000  93.6  95.8  97.9 100.0 102.0 103.6 101.8 100.0 100.0 100.0
                        40000  93.7  95.8  98.0 100.0 102.1 102.9 101.1  99.3  99.3  99.3
                        45000  93.1  95.3  97.4  99.5 101.5 102.3 100.5 100.5 100.5 100.5
                    </tableData>
                </table>
                <!-- TODO: FL220-270: Subtract 0.8 for engine anti-ice and 1.6 for engine + wing anti-ice-->
                <!-- TODO: FL280-330: Subtract 1.0 for engine anti-ice and 2.0 for engine + wing anti-ice-->
                <!-- TODO: FL340-390: Subtract 1.5 for engine anti-ice and 2.9 for engine + wing anti-ice-->
                <!-- TODO: FL400-450: Subtract 1.9 for engine anti-ice and 3.7 for engine + wing anti-ice-->
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/cruise">
            <function>
                <quotient>
                    <floor>
                        <sum>
                            <product>
                                <property>/systems/fadec/limit/cruise-table</property>
                                <value>10</value>
                            </product>
                            <value>0.5</value> <!-- Make it round correctly -->
                        </sum>
                    </floor>
                    <value>10</value>
                </quotient>
            </function>
        </fcs_function>

        <switch name="/systems/fadec/limit/active">
            <default value="100"/>
            <test value="/systems/fadec/limit/takeoff">
                /systems/fadec/limit/active-mode-int eq 0
            </test>
            <test value="/systems/fadec/limit/go-around">
                /systems/fadec/limit/active-mode-int eq 1
            </test>
            <test value="/systems/fadec/limit/mct">
                /systems/fadec/limit/active-mode-int eq 2
            </test>
            <test value="/systems/fadec/limit/climb">
                /systems/fadec/limit/active-mode-int eq 3
            </test>
            <test value="/systems/fadec/limit/cruise">
                /systems/fadec/limit/active-mode-int eq 4
            </test>
        </switch>

        <fcs_function name="/systems/fadec/limit/active-norm">
            <function>
                <table>
                    <independentVar lookup="row">/systems/fadec/limit/active</independentVar> <!-- Selected by nasal -->
                    <tableData>
                         25.0  0
                        117.5  1
                    </tableData>
                </table>
            </function>
            <output>/it-autoflight/settings/autothrottle-max</output>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/max">
            <function>
                <ifthen> <!-- When in takeoff, enforce takeoff, else take highest -->
                    <eq>
                        <property>/systems/fadec/limit/active-mode-int</property>
                        <value>0</value>
                    </eq>
                    <property>/systems/fadec/limit/takeoff-no-flex</property>
                    <max> <!-- MCT is always higher than CLB or CRZ, so we don't need to check them -->
                        <property>/systems/fadec/limit/go-around</property>
                        <property>/systems/fadec/limit/mct</property>
                    </max>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/limit/max-norm">
            <function>
                <table>
                    <independentVar lookup="row">/systems/fadec/limit/max</independentVar>
                    <tableData>
                         25.0  0
                        117.5  1
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <switch name="/systems/fadec/limit/approach-idle">
            <default value="0"/>
            <test logic="AND" value="1">
                position/wow eq 0
                fcs/flaps/int-cmd-deg ge 1
            </test>
        </switch>

        <switch name="/systems/fadec/limit/idle">
            <default value="25"/>
            <test logic="AND" value="33">
                position/wow eq 0
                fcs/flaps/cmd-detent-deg ge 1
             </test>r
        </switch>

        <fcs_function name="/systems/fadec/limit/idle-norm">
            <function>
                <table>
                    <independentVar lookup="row">/systems/fadec/limit/idle</independentVar>
                    <tableData>
                         25.0  0
                        117.5  1
                    </tableData>
                </table>
            </function>
            <output>/it-autoflight/settings/autothrottle-min</output>
        </fcs_function>

    </channel>

    <channel name="Reversers">

        <!-- Engine 1 -->
        <switch name="/systems/fadec/reverse-1/position-cmd">
            <default value="0" />
            <test value="1">
                /systems/fadec/reverse-1/engage eq 1
            </test>
            <test logic="AND" value="1"> <!-- Don't stow until thrust is reduced enough -->
                /engines/engine[0]/n1-actual ge 40
                /systems/fadec/reverse-1/position-cmd eq 1 </test>
            <output>/systems/fadec/reverse-1/position-cmd-out</output>
        </switch>

        <!-- TODO: link to pneumatic system -->
        <switch name="/systems/fadec/reverse-1/position-rate">
            <default value="0" />
            <test logic="OR" value="1">
                propulsion/engine[0]/n1 ge 25
            </test>
        </switch>

        <actuator name="/systems/fadec/reverse-1/position-norm">
            <input>/systems/fadec/reverse-1/position-cmd</input>
            <rate_limit>/systems/fadec/reverse-1/position-rate</rate_limit>
            <output>/engines/engine[0]/reverser-pos-norm</output>
        </actuator>

        <pure_gain name="propulsion/engine[0]/reverser-angle-rad">
            <input>/systems/fadec/reverse-1/position-norm</input>
            <gain>3.14</gain>
        </pure_gain>

        <switch name="/systems/fadec/reverse-1/interlock"> <!-- Locked until 60% open, unlocked until 20% closed -->
            <default value="/systems/fadec/reverse-1/interlock" />
            <test value="0">
                /systems/fadec/reverse-1/position-norm ge 0.6
            </test>
            <test value="1">
                /systems/fadec/reverse-1/position-norm le 0.2
            </test>
        </switch>

        <fcs_function name="/systems/fadec/reverse-1/throttle-rev-cmd">
            <function>
                <ifthen>
                    <eq>
                        <property>/systems/fadec/reverse-1/interlock</property>
                        <value>0</value>
                    </eq>
                    <table>
                        <independentVar lookup="row">/controls/engines/engine[0]/throttle</independentVar>
                        <tableData>
                            0.05 0.05
                            1.00 0.84
                        </tableData>
                    </table>
                    <value>0</value>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/reverse-1/throttle-lever">
            <function>
                <product>
                    <property>/systems/fadec/reverse-1/engage</property>
                    <table>
                        <independentVar lookup="row">/systems/fadec/reverse-1/throttle-rev-cmd</independentVar>
                        <tableData>
                            0.05 0.25
                            0.84 1.00
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <switch name="/systems/fadec/reverse-1/throttle-rev">
            <default value="0" />
            <test value="/systems/fadec/reverse-1/throttle-rev-cmd">
                /systems/fadec/reverse-1/engage eq 1
            </test>
            <clipto>
                <min>0.05</min>
                <max>1.0</max>
            </clipto>
        </switch>

        <switch name="/systems/fadec/reverse-1/active">
            <default value="0" />
            <test logic="OR" value="1">
                /systems/fadec/reverse-1/position-cmd eq 1
                /systems/fadec/reverse-1/position-norm ne 0
            </test>
        </switch>

        <!-- Engine 2 -->
        <switch name="/systems/fadec/reverse-2/position-cmd">
            <default value="0" />
            <test value="1">
                /systems/fadec/reverse-2/engage eq 1
            </test>
            <test logic="AND" value="1"> <!-- Don't stow until thrust is reduced enough -->
                /engines/engine[1]/n1-actual ge 40
                /systems/fadec/reverse-2/position-cmd eq 1 </test>
            <output>/systems/fadec/reverse-2/position-cmd-out</output>
        </switch>

        <!-- TODO: link to pneumatic system -->
        <switch name="/systems/fadec/reverse-2/position-rate">
            <default value="0" />
            <test logic="OR" value="1">
                propulsion/engine[1]/n1 ge 25
            </test>
        </switch>

        <actuator name="/systems/fadec/reverse-2/position-norm">
            <input>/systems/fadec/reverse-2/position-cmd</input>
            <rate_limit>/systems/fadec/reverse-2/position-rate</rate_limit>
            <output>/engines/engine[1]/reverser-pos-norm</output>
        </actuator>

        <pure_gain name="propulsion/engine[1]/reverser-angle-rad">
            <input>/systems/fadec/reverse-2/position-norm</input>
            <gain>3.14</gain>
        </pure_gain>

        <switch name="/systems/fadec/reverse-2/interlock"> <!-- Locked until 60% open, unlocked until 20% closed -->
            <default value="/systems/fadec/reverse-2/interlock" />
            <test value="0">
                /systems/fadec/reverse-2/position-norm ge 0.6
            </test>
            <test value="1">
                /systems/fadec/reverse-2/position-norm le 0.2
            </test>
        </switch>

        <fcs_function name="/systems/fadec/reverse-2/throttle-rev-cmd">
            <function>
                <ifthen>
                    <eq>
                        <property>/systems/fadec/reverse-2/interlock</property>
                        <value>0</value>
                    </eq>
                    <table>
                        <independentVar lookup="row">/controls/engines/engine[1]/throttle</independentVar>
                        <tableData>
                            0.05 0.05
                            1.00 0.84
                        </tableData>
                    </table>
                    <value>0</value>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/reverse-2/throttle-lever">
            <function>
                <product>
                    <property>/systems/fadec/reverse-2/engage</property>
                    <table>
                        <independentVar lookup="row">/systems/fadec/reverse-2/throttle-rev-cmd</independentVar>
                        <tableData>
                            0.05 0.25
                            0.84 1.00
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <switch name="/systems/fadec/reverse-2/throttle-rev">
            <default value="0" />
            <test value="/systems/fadec/reverse-2/throttle-rev-cmd">
                /systems/fadec/reverse-2/engage eq 1
            </test>
            <clipto>
                <min>0.05</min>
                <max>1.0</max>
            </clipto>
        </switch>

        <switch name="/systems/fadec/reverse-2/active">
            <default value="0" />
            <test logic="OR" value="1">
                /systems/fadec/reverse-2/position-cmd eq 1
                /systems/fadec/reverse-2/position-norm ne 0
            </test>
        </switch>

        <!-- Engine 3 -->
        <switch name="/systems/fadec/reverse-3/position-cmd">
            <default value="0" />
            <test value="1">
                /systems/fadec/reverse-3/engage eq 1
            </test>
            <test logic="AND" value="1"> <!-- Don't stow until thrust is reduced enough -->
                /engines/engine[2]/n1-actual ge 40
                /systems/fadec/reverse-3/position-cmd eq 1 </test>
            <output>/systems/fadec/reverse-3/position-cmd-out</output>
        </switch>

        <!-- TODO: link to pneumatic system -->
        <switch name="/systems/fadec/reverse-3/position-rate">
            <default value="0" />
            <test logic="OR" value="1">
                propulsion/engine[2]/n1 ge 25
            </test>
        </switch>

        <actuator name="/systems/fadec/reverse-3/position-norm">
            <input>/systems/fadec/reverse-3/position-cmd</input>
            <rate_limit>/systems/fadec/reverse-3/position-rate</rate_limit>
            <output>/engines/engine[2]/reverser-pos-norm</output>
        </actuator>

        <pure_gain name="propulsion/engine[2]/reverser-angle-rad">
            <input>/systems/fadec/reverse-3/position-norm</input>
            <gain>3.14</gain>
        </pure_gain>

        <switch name="/systems/fadec/reverse-3/interlock"> <!-- Locked until 60% open, unlocked until 20% closed -->
            <default value="/systems/fadec/reverse-3/interlock" />
            <test value="0">
                /systems/fadec/reverse-3/position-norm ge 0.6
            </test>
            <test value="1">
                /systems/fadec/reverse-3/position-norm le 0.2
            </test>
        </switch>

        <fcs_function name="/systems/fadec/reverse-3/throttle-rev-cmd">
            <function>
                <ifthen>
                    <eq>
                        <property>/systems/fadec/reverse-3/interlock</property>
                        <value>0</value>
                    </eq>
                    <table>
                        <independentVar lookup="row">/controls/engines/engine[2]/throttle</independentVar>
                        <tableData>
                            0.05 0.05
                            1.00 0.84
                        </tableData>
                    </table>
                    <value>0</value>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/reverse-3/throttle-lever">
            <function>
                <product>
                    <property>/systems/fadec/reverse-3/engage</property>
                    <table>
                        <independentVar lookup="row">/systems/fadec/reverse-3/throttle-rev-cmd</independentVar>
                        <tableData>
                            0.05 0.25
                            0.84 1.00
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <switch name="/systems/fadec/reverse-3/throttle-rev">
            <default value="0" />
            <test value="/systems/fadec/reverse-3/throttle-rev-cmd">
                /systems/fadec/reverse-3/engage eq 1
            </test>
            <clipto>
                <min>0.05</min>
                <max>1.0</max>
            </clipto>
        </switch>

        <switch name="/systems/fadec/reverse-3/active">
            <default value="0" />
            <test logic="OR" value="1">
                /systems/fadec/reverse-3/position-cmd eq 1
                /systems/fadec/reverse-3/position-norm ne 0
            </test>
        </switch>

        <!-- Engine 4 -->
        <switch name="/systems/fadec/reverse-4/position-cmd">
            <default value="0" />
            <test value="1">
                /systems/fadec/reverse-4/engage eq 1
            </test>
            <test logic="AND" value="1"> <!-- Don't stow until thrust is reduced enough -->
                /engines/engine[3]/n1-actual ge 40
                /systems/fadec/reverse-4/position-cmd eq 1 </test>
            <output>/systems/fadec/reverse-4/position-cmd-out</output>
        </switch>

        <!-- TODO: link to pneumatic system -->
        <switch name="/systems/fadec/reverse-4/position-rate">
            <default value="0" />
            <test logic="OR" value="1">
                propulsion/engine[3]/n1 ge 25
            </test>
        </switch>

        <actuator name="/systems/fadec/reverse-4/position-norm">
            <input>/systems/fadec/reverse-4/position-cmd</input>
            <rate_limit>/systems/fadec/reverse-4/position-rate</rate_limit>
            <output>/engines/engine[3]/reverser-pos-norm</output>
        </actuator>

        <pure_gain name="propulsion/engine[3]/reverser-angle-rad">
            <input>/systems/fadec/reverse-4/position-norm</input>
            <gain>3.14</gain>
        </pure_gain>

        <switch name="/systems/fadec/reverse-4/interlock"> <!-- Locked until 60% open, unlocked until 20% closed -->
            <default value="/systems/fadec/reverse-4/interlock" />
            <test value="0">
                /systems/fadec/reverse-4/position-norm ge 0.6
            </test>
            <test value="1">
                /systems/fadec/reverse-4/position-norm le 0.2
            </test>
        </switch>

        <fcs_function name="/systems/fadec/reverse-4/throttle-rev-cmd">
            <function>
                <ifthen>
                    <eq>
                        <property>/systems/fadec/reverse-4/interlock</property>
                        <value>0</value>
                    </eq>
                    <table>
                        <independentVar lookup="row">/controls/engines/engine[3]/throttle</independentVar>
                        <tableData>
                            0.05 0.05
                            1.00 0.84
                        </tableData>
                    </table>
                    <value>0</value>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="/systems/fadec/reverse-4/throttle-lever">
            <function>
                <product>
                    <property>/systems/fadec/reverse-4/engage</property>
                    <table>
                        <independentVar lookup="row">/systems/fadec/reverse-4/throttle-rev-cmd</independentVar>
                        <tableData>
                            0.05 0.25
                            0.84 1.00
                        </tableData>
                    </table>
                </product>
            </function>
        </fcs_function>

        <switch name="/systems/fadec/reverse-4/throttle-rev">
            <default value="0" />
            <test value="/systems/fadec/reverse-4/throttle-rev-cmd">
                /systems/fadec/reverse-4/engage eq 1
            </test>
            <clipto>
                <min>0.05</min>
                <max>1.0</max>
            </clipto>
        </switch>

        <switch name="/systems/fadec/reverse-4/active">
            <default value="0" />
            <test logic="OR" value="1">
                /systems/fadec/reverse-4/position-cmd eq 1
                /systems/fadec/reverse-4/position-norm ne 0
            </test>
        </switch>

    </channel>

    <channel name="Engine Control">

        <!-- Engine 1 -->
        <switch name="/systems/fadec/control-1/max">
            <default value="/systems/fadec/limit/max-norm" />
            <test value="1">
                /controls/fadec/altn-1 eq 1
            </test>
        </switch>

        <switch name="/systems/fadec/control-1/min">
            <default value="/systems/fadec/limit/idle-norm" />
            <test value="0">
                /controls/fadec/altn-1 eq 1
            </test>
        </switch>

        <switch name="/systems/fadec/control-1/throttle-pos">
            <default value="/controls/engines/engine[0]/throttle" />
            <test value="0">
                /systems/fadec/reverse-1/active eq 1
            </test>
        </switch>

        <lag_filter name="/systems/fadec/control-1/throttle-pos-lag">
            <input>/systems/fadec/control-1/throttle-pos</input>
            <c1>20</c1>
        </lag_filter>

        <switch name="/systems/fadec/control-1/throttle-cmd">
            <default value="/systems/fadec/control-1/throttle-pos" />
            <test value="/systems/fadec/reverse-1/throttle-rev">
                /systems/fadec/reverse-1/active eq 1
            </test>
            <clipto>
                <min>0.0</min> <!-- Intentional -->
                <max>/systems/fadec/control-1/max</max>
            </clipto>
        </switch>

        <lag_filter name="/systems/fadec/control-1/throttle-lag">
            <input>/systems/fadec/control-1/throttle-cmd</input>
            <c1>20</c1>
        </lag_filter>

        <fcs_function name="/systems/fadec/control-1/throttle-n1">
            <function>
                <table>
                    <independentVar lookup="row">/systems/fadec/control-1/throttle-lag</independentVar>
                    <tableData>
                        0  25.0
                        1 117.5
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <pure_gain name="/systems/fadec/control-1/throttle-pos-clamped">
            <input>/systems/fadec/control-1/throttle-pos</input>
            <gain>1.0</gain>
            <clipto>
                <min>/systems/fadec/control-1/min</min>
                <max>/systems/fadec/control-1/max</max>
            </clipto>
        </pure_gain>

        <switch name="/systems/fadec/control-1/throttle-output">
            <default value="/systems/fadec/control-1/throttle-pos-clamped" />
            <test value="/systems/fadec/reverse-1/throttle-rev">
                /systems/fadec/reverse-1/active eq 1
            </test>
            <clipto>
                <min>/systems/fadec/control-1/min</min>
                <max>1.0</max> <!-- Intentional -->
            </clipto>
        </switch>

        <lag_filter name="/systems/fadec/control-1/throttle-fdm">
            <input>/systems/fadec/control-1/throttle-output</input>
            <c1>0.75</c1>
            <output>fcs/throttle-pos-norm[0]</output>
        </lag_filter>

        <!-- Engine 2 -->
        <switch name="/systems/fadec/control-2/max">
            <default value="/systems/fadec/limit/max-norm" />
            <test value="1">
                /controls/fadec/altn-2 eq 1
            </test>
        </switch>

        <switch name="/systems/fadec/control-2/min">
            <default value="/systems/fadec/limit/idle-norm" />
            <test value="0">
                /controls/fadec/altn-2 eq 1
            </test>
        </switch>

        <switch name="/systems/fadec/control-2/throttle-pos">
            <default value="/controls/engines/engine[1]/throttle" />
            <test value="0">
                /systems/fadec/reverse-2/active eq 1
            </test>
        </switch>

        <lag_filter name="/systems/fadec/control-2/throttle-pos-lag">
            <input>/systems/fadec/control-2/throttle-pos</input>
            <c1>20</c1>
        </lag_filter>

        <switch name="/systems/fadec/control-2/throttle-cmd">
            <default value="/systems/fadec/control-2/throttle-pos" />
            <test value="/systems/fadec/reverse-2/throttle-rev">
                /systems/fadec/reverse-2/active eq 1
            </test>
            <clipto>
                <min>0.0</min> <!-- Intentional -->
                <max>/systems/fadec/control-2/max</max>
            </clipto>
        </switch>

        <lag_filter name="/systems/fadec/control-2/throttle-lag">
            <input>/systems/fadec/control-2/throttle-cmd</input>
            <c1>20</c1>
        </lag_filter>

        <fcs_function name="/systems/fadec/control-2/throttle-n1">
            <function>
                <table>
                    <independentVar lookup="row">/systems/fadec/control-2/throttle-lag</independentVar>
                    <tableData>
                        0  25.0
                        1 117.5
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <pure_gain name="/systems/fadec/control-2/throttle-pos-clamped">
            <input>/systems/fadec/control-2/throttle-pos</input>
            <gain>1.0</gain>
            <clipto>
                <min>/systems/fadec/control-2/min</min>
                <max>/systems/fadec/control-2/max</max>
            </clipto>
        </pure_gain>

        <switch name="/systems/fadec/control-2/throttle-output">
            <default value="/systems/fadec/control-2/throttle-pos-clamped" />
            <test value="/systems/fadec/reverse-2/throttle-rev">
                /systems/fadec/reverse-2/active eq 1
            </test>
            <clipto>
                <min>/systems/fadec/control-2/min</min>
                <max>1.0</max> <!-- Intentional -->
            </clipto>
        </switch>

        <lag_filter name="/systems/fadec/control-2/throttle-fdm">
            <input>/systems/fadec/control-2/throttle-output</input>
            <c1>0.75</c1>
            <output>fcs/throttle-pos-norm[1]</output>
        </lag_filter>

        <!-- Engine 3 -->
        <switch name="/systems/fadec/control-3/max">
            <default value="/systems/fadec/limit/max-norm" />
            <test value="1">
                /controls/fadec/altn-3 eq 1
            </test>
        </switch>

        <switch name="/systems/fadec/control-3/min">
            <default value="/systems/fadec/limit/idle-norm" />
            <test value="0">
                /controls/fadec/altn-3 eq 1
            </test>
        </switch>

        <switch name="/systems/fadec/control-3/throttle-pos">
            <default value="/controls/engines/engine[2]/throttle" />
            <test value="0">
                /systems/fadec/reverse-3/active eq 1
            </test>
        </switch>

        <lag_filter name="/systems/fadec/control-3/throttle-pos-lag">
            <input>/systems/fadec/control-3/throttle-pos</input>
            <c1>20</c1>
        </lag_filter>

        <switch name="/systems/fadec/control-3/throttle-cmd">
            <default value="/systems/fadec/control-3/throttle-pos" />
            <test value="/systems/fadec/reverse-3/throttle-rev">
                /systems/fadec/reverse-3/active eq 1
            </test>
            <clipto>
                <min>0.0</min> <!-- Intentional -->
                <max>/systems/fadec/control-3/max</max>
            </clipto>
        </switch>

        <lag_filter name="/systems/fadec/control-3/throttle-lag">
            <input>/systems/fadec/control-3/throttle-cmd</input>
            <c1>20</c1>
        </lag_filter>

        <fcs_function name="/systems/fadec/control-3/throttle-n1">
            <function>
                <table>
                    <independentVar lookup="row">/systems/fadec/control-3/throttle-lag</independentVar>
                    <tableData>
                        0  25.0
                        1 117.5
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <pure_gain name="/systems/fadec/control-3/throttle-pos-clamped">
            <input>/systems/fadec/control-3/throttle-pos</input>
            <gain>1.0</gain>
            <clipto>
                <min>/systems/fadec/control-3/min</min>
                <max>/systems/fadec/control-3/max</max>
            </clipto>
        </pure_gain>

        <switch name="/systems/fadec/control-3/throttle-output">
            <default value="/systems/fadec/control-3/throttle-pos-clamped" />
            <test value="/systems/fadec/reverse-3/throttle-rev">
                /systems/fadec/reverse-3/active eq 1
            </test>
            <clipto>
                <min>/systems/fadec/control-3/min</min>
                <max>1.0</max> <!-- Intentional -->
            </clipto>
        </switch>

        <lag_filter name="/systems/fadec/control-3/throttle-fdm">
            <input>/systems/fadec/control-3/throttle-output</input>
            <c1>0.75</c1>
            <output>fcs/throttle-pos-norm[2]</output>
        </lag_filter>

        <!-- Engine 4 -->
        <switch name="/systems/fadec/control-4/max">
            <default value="/systems/fadec/limit/max-norm" />
            <test value="1">
                /controls/fadec/altn-4 eq 1
            </test>
        </switch>

        <switch name="/systems/fadec/control-4/min">
            <default value="/systems/fadec/limit/idle-norm" />
            <test value="0">
                /controls/fadec/altn-4 eq 1
            </test>
        </switch>

        <switch name="/systems/fadec/control-4/throttle-pos">
            <default value="/controls/engines/engine[3]/throttle" />
            <test value="0">
                /systems/fadec/reverse-4/active eq 1
            </test>
        </switch>

        <lag_filter name="/systems/fadec/control-4/throttle-pos-lag">
            <input>/systems/fadec/control-4/throttle-pos</input>
            <c1>20</c1>
        </lag_filter>

        <switch name="/systems/fadec/control-4/throttle-cmd">
            <default value="/systems/fadec/control-4/throttle-pos" />
            <test value="/systems/fadec/reverse-4/throttle-rev">
                /systems/fadec/reverse-4/active eq 1
            </test>
            <clipto>
                <min>0.0</min> <!-- Intentional -->
                <max>/systems/fadec/control-4/max</max>
            </clipto>
        </switch>

        <lag_filter name="/systems/fadec/control-4/throttle-lag">
            <input>/systems/fadec/control-4/throttle-cmd</input>
            <c1>20</c1>
        </lag_filter>

        <fcs_function name="/systems/fadec/control-4/throttle-n1">
            <function>
                <table>
                    <independentVar lookup="row">/systems/fadec/control-4/throttle-lag</independentVar>
                    <tableData>
                        0  25.0
                        1 117.5
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <pure_gain name="/systems/fadec/control-4/throttle-pos-clamped">
            <input>/systems/fadec/control-4/throttle-pos</input>
            <gain>1.0</gain>
            <clipto>
                <min>/systems/fadec/control-4/min</min>
                <max>/systems/fadec/control-4/max</max>
            </clipto>
        </pure_gain>

        <switch name="/systems/fadec/control-4/throttle-output">
            <default value="/systems/fadec/control-4/throttle-pos-clamped" />
            <test value="/systems/fadec/reverse-4/throttle-rev">
                /systems/fadec/reverse-4/active eq 1
            </test>
            <clipto>
                <min>/systems/fadec/control-4/min</min>
                <max>1.0</max> <!-- Intentional -->
            </clipto>
        </switch>

        <lag_filter name="/systems/fadec/control-4/throttle-fdm">
            <input>/systems/fadec/control-4/throttle-output</input>
            <c1>0.75</c1>
            <output>fcs/throttle-pos-norm[3]</output>
        </lag_filter>

        <!-- Comparator -->
        <fcs_function name="/systems/fadec/throttle-compare-max">
            <function>
                <max> <!-- Don't use clipped -->
                    <property>/systems/fadec/control-1/throttle-pos-lag</property>
                    <property>/systems/fadec/control-2/throttle-pos-lag</property>
                    <property>/systems/fadec/control-3/throttle-pos-lag</property>
                    <property>/systems/fadec/control-4/throttle-pos-lag</property>
                </max>
            </function>
        </fcs_function>

    </channel>

    <channel name="Engine Parameters" execrate="2">

        <lag_filter name="/systems/fadec/n1-actual-1">
            <input>/engines/engine[0]/n1</input>
            <c1>2.25</c1>
            <output>/engines/engine[0]/n1-actual</output>
            <!-- <output>/engines/engine[4]/n1</output> -->
        </lag_filter>

        <lag_filter name="/systems/fadec/n1-actual-2">
            <input>/engines/engine[1]/n1</input>
            <c1>2.25</c1>
            <output>/engines/engine[1]/n1-actual</output>
            <!-- <output>/engines/engine[5]/n1</output> -->
        </lag_filter>

        <lag_filter name="/systems/fadec/n1-actual-3">
            <input>/engines/engine[2]/n1</input>
            <c1>2.25</c1>
            <output>/engines/engine[2]/n1-actual</output>
            <!-- <output>/engines/engine[6]/n1</output> -->
        </lag_filter>

        <lag_filter name="/systems/fadec/n1-actual-4">
            <input>/engines/engine[3]/n1</input>
            <c1>2.25</c1>
            <output>/engines/engine[3]/n1-actual</output>
            <!-- <output>/engines/engine[6]/n1</output> -->
        </lag_filter>

    </channel>

    <channel name="EEC">
        <fcs_function name="atmosphere/temperature-degc">
            <function>
                <sum>
                    <product>
                        <property>atmosphere/T-R</property>
                        <value>0.55555555555</value>
                    </product>
                    <value>-273.15</value>
                </sum>
            </function>
        </fcs_function>
    </channel>

</system>
